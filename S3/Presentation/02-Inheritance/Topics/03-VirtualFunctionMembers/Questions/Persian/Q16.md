<div dir="rtl" style="text-align: right;">

## â“ Q16:

## Virtual Method Table (VMT) Ùˆ Dispatch Mechanism Ø¯Ù‚ÛŒÙ‚Ø§ Ú†Ø·ÙˆØ± Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù‡ØŸ

### âœ… Ø¬ÙˆØ§Ø¨ Ø¹Ù…ÛŒÙ‚:

Ù‡Ø± Ú©Ù„Ø§Ø³ Ø¨Ø§ virtual methods ÛŒÚ© **VMT** Ø¯Ø§Ø±Ù‡ Ú©Ù‡ Ø¯Ø± runtime Ø¨Ø±Ø§ÛŒ method dispatch Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´Ù‡.

### ğŸ” Ø³Ø§Ø®ØªØ§Ø± VMT:

<div dir="ltr" style="text-align: left;">

```csharp
class Base {
    public virtual void Method1() { }
    public virtual void Method2() { }
    public void Method3() { }  // Non-virtual
}

class Derived : Base {
    public override void Method1() { }  // Override
    // Method2 override Ù†Ø´Ø¯Ù‡
    public new void Method3() { }  // Hiding
}
```

<div dir="rtl" style="text-align: right;">

### ğŸ“Š VMT Layout:

<div dir="ltr" style="text-align: left;">

```
Base VMT:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [0] Base.Method1()  â”‚ â†’ Address: 0x1000
â”‚ [1] Base.Method2()  â”‚ â†’ Address: 0x2000
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Derived VMT:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [0] Derived.Method1()â”‚ â†’ Address: 0x3000 (Override Ø´Ø¯Ù‡)
â”‚ [1] Base.Method2()   â”‚ â†’ Address: 0x2000 (Ø§Ø² Base Ø§Ø±Ø« Ø¨Ø±Ø¯Ù‡)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

<div dir="rtl" style="text-align: right;">

### âš™ï¸ Dispatch Mechanism:

<div dir="ltr" style="text-align: left;">

```csharp
Base obj = new Derived();
obj.Method1();  // Ú†Ù‡ Ø§ØªÙØ§Ù‚ÛŒ Ù…ÛŒâ€ŒØ§ÙØªÙ‡ØŸ

// 1. Runtime Ù†ÙˆØ¹ ÙˆØ§Ù‚Ø¹ÛŒ Ø±Ùˆ Ù…ÛŒâ€ŒØ®ÙˆÙ†Ù‡: Derived
// 2. Ø¨Ù‡ Derived VMT Ù…ÛŒâ€ŒØ±Ù‡
// 3. Index [0] Ø±Ùˆ Ù…ÛŒâ€ŒØ®ÙˆÙ†Ù‡ (Method1)
// 4. Ø¨Ù‡ Ø¢Ø¯Ø±Ø³ 0x3000 Ù…ÛŒâ€ŒÙ¾Ø±Ù‡ â†’ Derived.Method1() Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´Ù‡
```

<div dir="rtl" style="text-align: right;">

### ğŸ”¬ Ø¬Ø²Ø¦ÛŒØ§Øª Implementation:

- **VMT Pointer** Ø¯Ø± Object Header Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´Ù‡ (8 bytes)
- Ù‡Ø± Ú©Ù„Ø§Ø³ ÙÙ‚Ø· **ÛŒÚ© VMT** Ø¯Ø§Ø±Ù‡ (shared Ø¨ÛŒÙ† Ù‡Ù…Ù‡ instances)
- **Index Ù‡Ø§** Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ±ØªÛŒØ¨ ØªØ¹Ø±ÛŒÙ virtual methods Ù‡Ø³ØªÙ†Ø¯
- Ø§Ú¯Ø± Ù…ØªØ¯ override Ù†Ø´Ù‡ØŒ VMT Ø¨Ù‡ Ù…ØªØ¯ Base Ø§Ø´Ø§Ø±Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ù‡

### âš¡ Performance:

- Virtual Call = 2-3 CPU cycles (VMT lookup)
- Direct Call = 1 CPU cycle (direct jump)

### ğŸ¯ Ù†Ú©ØªÙ‡ Ù¾ÛŒØ´Ø±ÙØªÙ‡:

JIT Compiler Ù…ÛŒâ€ŒØªÙˆÙ†Ù‡ Ø¯Ø± Ø¨Ø¹Ø¶ÛŒ Ù…ÙˆØ§Ø±Ø¯ **Devirtualization** Ø§Ù†Ø¬Ø§Ù… Ø¨Ø¯Ù‡ Ùˆ virtual call Ø±Ùˆ Ø¨Ù‡ direct call ØªØ¨Ø¯ÛŒÙ„ Ú©Ù†Ù‡ (Ø§Ú¯Ø± Ù†ÙˆØ¹ Ø¯Ø± compile-time Ù…Ø´Ø®Øµ Ø¨Ø§Ø´Ù‡).

