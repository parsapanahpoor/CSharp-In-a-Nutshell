<div dir="ltr" style="text-align: left;">

## â“ Q16:

## How exactly does Virtual Method Table (VMT) work?

### âœ… Deep Answer:

Each class with virtual methods has a **VMT** that is used at runtime.

<div dir="ltr" style="text-align: left;">

```csharp
class Animal {
    public virtual void Speak() => Console.WriteLine("Animal");
    public virtual void Move() => Console.WriteLine("Moving");
}

class Dog : Animal {
    public override void Speak() => Console.WriteLine("Woof");
    // Move() not overridden
}

class Cat : Animal {
    public override void Speak() => Console.WriteLine("Meow");
    public override void Move() => Console.WriteLine("Sneaking");
}
```

<div dir="ltr" style="text-align: left;">

### ğŸ” VMT Structure in Memory:

<div dir="ltr" style="text-align: left;">

```
Animal VMT:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [0] Animal.Speak()  â”‚ â†’ Address: 0x1000
â”‚ [1] Animal.Move()   â”‚ â†’ Address: 0x2000
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Dog VMT:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [0] Dog.Speak()     â”‚ â†’ Address: 0x3000 (Overridden)
â”‚ [1] Animal.Move()   â”‚ â†’ Address: 0x2000 (Inherited from Base)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Cat VMT:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [0] Cat.Speak()     â”‚ â†’ Address: 0x4000 (Overridden)
â”‚ [1] Cat.Move()      â”‚ â†’ Address: 0x5000 (Overridden)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

<div dir="ltr" style="text-align: left;">

### âš™ï¸ Call Mechanism:

<div dir="ltr" style="text-align: left;">

```csharp
Animal animal = new Dog();
animal.Speak();  // What happens?

// 1. Runtime checks actual type: Dog
// 2. Goes to Dog class VMT
// 3. Reads index [0] (Speak method)
// 4. Jumps to address 0x3000 â†’ Dog.Speak() executes
```

<div dir="ltr" style="text-align: left;">

### ğŸ¯ Advanced Points:

- **VMT is stored in Object Header** (8 bytes overhead)
- Each class has only **one VMT** (shared among all instances)
- **Indices** are based on the order of virtual method definitions
- If method is not overridden, VMT points to Base method

### âš ï¸ Performance:

- Virtual Call = 2-3 CPU cycles (must check VMT)
- Direct Call = 1 CPU cycle (jumps directly to address)
